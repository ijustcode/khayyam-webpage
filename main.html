<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sectional Static Website</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #FFCC99; /* light orange */
        }
        .section {
            margin-bottom: 40px;
            background-color: #CCFFCC; /* light green */
            border: 1px solid #000; /* black border */
            width: 80%; /* control the width */
            margin: auto; /* center the section */
        }        
        .section h2 {
            color: #333;
        }
        .section p {
            color: #666;
        }
        .centered-image {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>

    <div class="section">
        <h2>Robaa'iyaat-e Khayyam</h2>
        <p>اینجا متن فارسی شعر قرار می‌گیرد.</p>
        <img class="centered-image" src="images/Nastaliq.jpeg" alt="Descriptive text about the image" width="1000" height="400">
    </div>

    <div class="section">
        <h2>Transliteration of Lyrics to English</h2>
        <p>Inja matn-e Farsi-e sher gharar migirad.</p>
    </div>

    <div class="section">
        <h2>Poetic Transliteration of Lyrics to English</h2>
        <p>The poetic translation to English goes here</p>
    </div>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBfkL5WGRmnoaDhBkbK4sB7nhi59GUrQ-M",
            authDomain: "khayyam-backend.firebaseapp.com",
            projectId: "khayyam-backend",
            storageBucket: "khayyam-backend.appspot.com",
            messagingSenderId: "87530331229",
            appId: "1:87530331229:web:3f00dc141b1c1a599941b4"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
      
        document.addEventListener('DOMContentLoaded', function() {
          fetchComments();
          const submitButton = document.getElementById('submitCommentButton');
          if(submitButton) {
              submitButton.addEventListener('click', submitComment);
          }
        });
      
        async function submitComment() {
          const commentInput = document.getElementById('comment-input');
          const commentText = commentInput.value.trim();
          if (commentText === "") {
            alert("Please enter a comment before submitting.");
            return;
          }
          const username = "User" + Math.floor(Math.random() * 1000); // Generate a random username

          try {
            await addDoc(collection(db, "comments"), {
              username: username,
              comment: commentText,
              timestamp: serverTimestamp()
            });
            console.log("Document successfully written!");
            commentInput.value = ''; // Clear the input field after submission
            fetchComments(); // Refresh the comments section to include the new comment
          } catch (e) {
            console.error("Error adding document: ", e);
          }
        }
      
        async function fetchComments() {
          const commentsDiv = document.getElementById('comments');
        commentsDiv.innerHTML = ''; // Clear existing comments before fetching

        const q = query(collection(db, "comments"), orderBy("timestamp", "desc"));

        try {
          const querySnapshot = await getDocs(q);
          querySnapshot.forEach((doc) => {
            const comment = doc.data();
            commentsDiv.innerHTML += `<p><strong>${comment.username}:</strong> ${comment.comment}</p>`;
          });
        } catch (e) {
          console.error("Error fetching documents: ", e);
        }
        }
      </script>
      
    <div class="section" id="comments-section">
        <h2>Comments</h2>
        <input type="text" id="comment-input" placeholder="Leave a comment" />
        <button id="submitCommentButton">Submit</button>
        <div id="comments"></div>
    </div>

</body>
</html>
